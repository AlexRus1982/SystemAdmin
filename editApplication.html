<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://fonts.googleapis.com/css2?family=Kumbh+Sans:wght@300;400;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.min.css"
    />
    <link rel="stylesheet" href="CSS/normalize.css" />
    <link rel="stylesheet" href="CSS/style.css" />
    <link rel="stylesheet" href="CSS/style_header.css" />
    <link rel="stylesheet" href="CSS/style_editApplication.css" />
    <title>leger</title>
  </head>
  <body>    
    <a name="top"></a>

    <div class="mainPage">
      
      <!-- Заголовок -->
      <div class="header">
      </div>

      <div class="viewButton">
        <a href="http://test1/thegame.html?id=6" class="viewButton__text" target="_blank">Просмотр</a>
      </div>

      <div class="saveButton">
        <div class="saveButtonArrow"></div>        
        <a href="" class="saveButton__text">  Сохранить </a>
      </div>

      <div class="nameApplication">Название приложения</div>
      <div class="nameApplication__input"><input type="text" class="nameApplication__input__text"></div>
      <div class="sinonimURL">Синоним для URL запроса</div>
      <div class="sinonimURL__input"><input type="text" class="sinonimURL__input__text"></div>
      <!--<div class="sinonimURL__input__box"></div>-->
      <div class="fileLink">Ссылка на файл</div>
      <div class="fileLink__input"><input type="text" class="fileLink__input__text"></div>
      <!--<div class="fileLink__input__box"></div>-->

      <div class="imageApplication">
        <div class="imageApplication__edit-button"></div>
        <div class="imageApplication__delete-button"></div>
      </div>

      <!--
      <div class="imageAdd__text">Добавить изображение</div>
      <div class="imageDelete__text">Удалить изображение</div>
      -->

      <div class="textEditor"><textarea id="textEditArea"></textarea></div>

      <div class="printScreen__text">Скриншоты</div>
      <div class="printScreen__images">
        <!--
        <img class="printScreen__image"></img>
        <img class="printScreen__image"></img>
        <img class="printScreen__image"></img>
        <img class="printScreen__image"></img>
        <img class="printScreen__image"></img>
        <img class="printScreen__image"></img>
        <img class="printScreen__image"></img>
        <img class="printScreen__image"></img>
        -->
      </div>
      <div class="printScreen__add"></div>

      <div class="activity__text">Активность</div>
      <div class="activity__checkBox">
      </div>

      <div class="category__text">Категории</div>
      <div class="category__content">1<br>2<br></div>
      <a href="" class="category__add__text">Добавить</a>
      <a href="" class="category__default__text">По умолчанию</a>

      <div class="applicationInfo__text">
        Разработчик:<br>
        Категории:<br>
        Версия Android:<br>
        Обновлено:<br>
        Рейтинг:<br>
        Размер:<br>
        Возрастное ограничение:<br>
        Скачали:<br>
        Распространяется:
      </div>

      <div class="applicationInfo__data">
        Talking friend<br>
        казуальные<br>
        4.1+<br>
        29.03.2021<br>
        4,3<br>
        69 МБ<br>
        12+<br>
        1544<br>
        бесплатно
      </div>

      <div class="video__text">Видео</div>
      <div class="videos">
        <!--
        <div class="video__image0"></div>
        <div class="video__image1"></div>
        <div class="video__image2"></div>
        <div class="video__image3"></div>
        <div class="video__image4"></div>
        <div class="video__image5"></div>
        -->
      </div>
      <div class="video__add"></div>


      <div class="versions__text">Версии</div>

      <div class="versions__list">
        <!--
        <div class="version__info">
          <div class="version__info__column0">Название</div><div class="version__info__column1">Супер приложение версии 3.3</div>
          <div class="version__info__column0">Размер</div><div class="version__info__column1">55 МБ</div>
          <div class="version__info__column0">Дата загрузки</div><div class="version__info__column1">22.10.1968</div>
          <div class="version__info__column0">Ссылка на файл</div><div class="version__info__column1">адрес сайта</div>
        </div>
        -->
      </div>

      <div class="versions__add"></div>

    </div>

    <script
      src="https://code.jquery.com/jquery-3.6.0.min.js"
      integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
      crossorigin="anonymous">    
    </script>

    <script
      src="https://code.jquery.com/ui/1.13.1/jquery-ui.min.js"
      integrity="sha256-eTyxS0rkjpLEo16uXTS0uVCS4815lc40K2iVpWDvdSY="
      crossorigin="anonymous">      
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.min.js"></script>

    <script src="JS/script.js"></script>

    <script src="//js.nicedit.com/nicEdit-latest.js" type="text/javascript"></script>

    <script>
      $(function(){
        $(".header").load("header.html", function () {
          $(".header__Applications").addClass("header__Active");
        });
      });

      bkLib.onDomLoaded(function() {
        new nicEditor({fullPanel : true, maxHeight : 354}).panelInstance('textEditArea');
      });


      var appId = $_GET('appId');
      if (appId <= 0 || appId == null){
        appId = 0;
      }

      $.get( "/php/base.php", { method: 'getAppInfo', appId: appId } )
        .done(function( data ) {
          let json = JSON.parse(data);
          /*
          alert(json['version1'] + '\n' + 
                json['version2'] + '\n' + 
                json['version3'] + '\n' + 
                json['version4']);
          */

          $('.nameApplication__input__text').val(json['name']);
          $('.sinonimURL__input__text').val(json['url']);
          $('.fileLink__input__text').val(json['file']);

          $('.imageApplication').append('<img src="' + json['main_image'] + '" class="imageApplication__image"></img>');
          $('.nicEdit-main').append(json['description']);

          $('.imageApplication__edit-button').click(function() {
            
            var parent = $(this).parent();            
            var image = parent.find('img');

            var path = prompt("Изменить путь", image.attr('src'));
            if (path != null && path != '') {
              image.attr('src', path);
            }

          });

          $('.imageApplication__delete-button').click(function() {
            var result = confirm("Удалить картинку?");

            if (result) {
              var parent = $(this).parent();
              var image = parent.find('img').attr('src', '');
            }
          });


          if (json['images'].length > 0) {
            var images = json['images'].split(';');
            for (let i = 0; i < images.length; i++)
            {
              let image   = '<div class="printScreen__image__wrapper">';
                  image  += '<a href="' + images[i] + '" target="_blank">';
                  image  += '<div class="printScreen__image__edit-button"></div>'
                  image  += '<div class="printScreen__image__delete-button"></div>'
                  image  += '<img class="printScreen__image" src="' + images[i] + '"></img>'
                  image  += '</a></div>';
              $('.printScreen__images').append(image);
            }
            $('.printScreen__images').sortable({
              //helper: fixHelper,
            });
          }


          $('.printScreen__image__edit-button').click(function(event) {
            
            var parent = $(this).parent();            
            var image = parent.find('img');

            var path = prompt("Изменить путь", image.attr('src'));
            if (path != null && path != '') {
              image.attr('src', path);
            }

            event.preventDefault();
          });

          $('.printScreen__image__delete-button').click(function(event) {
            var result = confirm("Удалить картинку?");
            if (result) {
              $(this).parent().remove();
            }
            event.preventDefault();
          });

          $('.printScreen__add').click(function() {
            var path = prompt("Введите путь", '');
            if (path != null && path != '') {
              let image   = '<div class="printScreen__image__wrapper">';
                  image  += '<a href="' + path + '" target="_blank">';
                  image  += '<div class="printScreen__image__edit-button"></div>';
                  image  += '<div class="printScreen__image__delete-button"></div>';
                  image  += '<img class="printScreen__image" src="' + path + '"></img>';
                  image  += '</a></div>';
              $('.printScreen__images').append(image);
            }
          });

          if (json['video'].length > 0) {
            var videos = json['video'].split(';');      
            for (let i = 0; i < videos.length; i++)
            {
              let video  = '<div class="video__wrapper">';
                  video += '<div class="video__edit-button"></div>';
                  video += '<div class="video__delete-button"></div>';
                  video += '<iframe class="video" src="' + videos[i] + '" frameborder="0" allowfullscreen="allowfullscreen"></iframe>';
                  video += '</div>';
              
              $('.videos').append(video);
              /*
              $('.videos').sortable({
              //helper: fixHelper,
              });
              */
            }
            /*
            <iframe src="https://www.youtube.com/embed/8nqKrrxlkio" width="160" height="100" frameborder="0" allowfullscreen="allowfullscreen"></iframe>
            */
          }

          $('.video__edit-button').click(function(event) {
            
            var parent = $(this).parent();            
            var video = parent.find('iframe');

            var path = prompt("Изменить путь", video.attr('src'));
            if (path != null && path != '') {
              video.attr('src', path);
            }

            event.preventDefault();
          });

          $('.video__delete-button').click(function(event) {
            var result = confirm("Удалить видео?");
            if (result) {
              $(this).parent().remove();
            }
            event.preventDefault();
          });

          $('.video__add').click(function() {
            var path = prompt("Введите путь", '');
            if (path != null && path != '') {
              let video  = '<div class="video__wrapper">';
                  video += '<div class="video__edit-button"></div>';
                  video += '<div class="video__delete-button"></div>';
                  video += '<iframe class="video" src="' + path + '" frameborder="0" allowfullscreen="allowfullscreen"></iframe>';
                  video += '</div>';
              
              $('.videos').append(video);
            }
          });


        /*
          <div class="applicationInfo__text">
        Разработчик:<br>
        Категории:<br>
        Версия Android:<br>
        Обновлено:<br>
        Рейтинг:<br>
        Размер:<br>
        Возрастное ограничение:<br>
        Скачали:<br>
        Распространяется:
      </div>

      <div class="applicationInfo__data">
        Talking friend<br>
        казуальные<br>
        4.1+<br>
        29.03.2021<br>
        4,3<br>
        69 МБ<br>
        12+<br>
        1544<br>
        бесплатно
      </div>
      */

        let category  = json['category'];
        if (category.indexOf('>') >= 0)
        {
          category = category.substring(category.indexOf('>') + 1);
        }

        let appInfo   = json['developer'] + "<br>";
            appInfo  += category + "<br>";
            appInfo  += json['android version'] + "<br>";
            appInfo  += json['update'] + "<br>";
            appInfo  += '4,3' + "<br>";
            appInfo  += json['size'] + "<br>";
            appInfo  += json['limits'] + "<br>";
            appInfo  += json['downloads'] + "<br>";
            appInfo  += 'бесплатно' + "<br>";
        $('.applicationInfo__data').html(appInfo);
        $('.category__content').html(category);


        var activity = json['activity'];
        if (activity == '1') {
          $('.activity__checkBox').append('<div class="activity__checkBoxArrow"></div>');
        }

        $('.activity__checkBox').click(function(){
          var isArrow = $(this).find('.activity__checkBoxArrow');
          if (isArrow.length > 0) {
            $('.activity__checkBoxArrow').remove();
          }
          else {
            $('.activity__checkBox').append('<div class="activity__checkBoxArrow"></div>');
          }
        });

        let versions = new Array();
        versions.push(json['version1']);
        versions.push(json['version2']);
        versions.push(json['version3']);
        versions.push(json['version4']);

        for (let i = 0; i < versions.length; i++) {
          if (versions[i] != '') {
            let version_elements = versions[i].split(';');
            let version_number = version_elements[1].split(':')[1];
            let version_date   = version_elements[2].split(':')[1];
            let version_html  = '';
                version_html += '<div class="version__info">';
                version_html += '  <div class="version__info__column0">Версия</div><div class="version__info__column1">' + version_number + '</div>';
                version_html += '  <div class="version__info__column0">Дата</div><div class="version__info__column1">' + version_date + '</div>';
                version_html += '  <div class="version__info__column0">Ссылка на скачивание</div><div class="version__info__column1"><a href="' + version_elements[0] + '" target="_blank">скачать</a></div>';
                version_html += '</div>';
            $('.versions__list').append(version_html);          
          }
        }

        /* ссылка версия добавлено
        <div class="version__info">
          <div class="version__info__column0">Название</div><div class="version__info__column1">Супер приложение версии 3.3</div>
          <div class="version__info__column0">Размер</div><div class="version__info__column1">55 МБ</div>
          <div class="version__info__column0">Дата загрузки</div><div class="version__info__column1">22.10.1968</div>
          <div class="version__info__column0">Ссылка на файл</div><div class="version__info__column1">адрес сайта</div>
        </div>
        */
        
        $('.viewButton__text').attr('href', 'http://test1/thegame.html?id=' + appId);
        /*
        <a href="http://test1/thegame.html?id=6" class="viewButton__text"
        */

      });



    </script> 

  </body>
</html>
